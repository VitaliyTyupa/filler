<section class="waiting-page" *ngIf="settings as config">
  <mat-card appearance="outlined">
    <mat-card-header>
      <mat-card-title>Онлайн лобі</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div class="setup" *ngIf="!roomId; else lobbyView">
        <div class="panel">
          <h3>Створити кімнату</h3>
          <p>Використовуйте налаштування зі стартової сторінки та поділіться кодом.</p>
          <button mat-raised-button color="primary" type="button" (click)="onCreateRoom()">
            Створити кімнату
          </button>
        </div>

        <div class="panel">
          <h3>Приєднатися</h3>
          <p>Введіть код кімнати від свого друга, щоб продовжити.</p>
          <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>Код кімнати</mat-label>
            <input
              matInput
              name="room-code"
              [(ngModel)]="joinCode"
              placeholder="Наприклад, ABC123"
              autocomplete="off"
            />
          </mat-form-field>
          <button mat-stroked-button color="primary" type="button" (click)="onJoinRoom()">
            Приєднатися
          </button>
        </div>
      </div>

      <ng-template #lobbyView>
        <div class="lobby">
          <div class="room-meta">
            <div class="summary">
              <div class="summary-row">
                <span class="label">Board</span>
                <span class="value">{{ config.board.cols }}×{{ config.board.rows }}</span>
              </div>
              <div class="summary-row">
                <span class="label">Palette size</span>
                <span class="value">{{ config.paletteSize }}</span>
              </div>
              <div class="summary-row">
                <span class="label">Статус</span>
                <span class="value">{{ status }}</span>
              </div>
            </div>

            <div class="room-code">
              <span class="label">Код кімнати</span>
              <div class="code">{{ roomId }}</div>
            </div>
          </div>

          <div class="players">
            <div class="player-card" [class.connected]="players[1]">
              <div class="label">Гравець 1</div>
              <div class="name">{{ players[1]?.name || 'Очікуємо…' }}</div>
              <span class="role" *ngIf="players[1]">Host</span>
            </div>
            <div class="player-card" [class.connected]="players[2]">
              <div class="label">Гравець 2</div>
              <div class="name">{{ players[2]?.name || 'Очікуємо…' }}</div>
              <span class="role" *ngIf="players[2]">Guest</span>
            </div>
          </div>

          <div class="status">
            <div class="spinner" *ngIf="!hasSecondPlayer">
              <mat-progress-spinner mode="indeterminate" diameter="36"></mat-progress-spinner>
              <p>Очікуємо другого гравця…</p>
            </div>

            <div class="actions" *ngIf="isHost">
              <button mat-raised-button color="primary" type="button" [disabled]="!hasSecondPlayer" (click)="onStartGame()">
                Start game
              </button>
            </div>
          </div>
        </div>
      </ng-template>
    </mat-card-content>
  </mat-card>
</section>
